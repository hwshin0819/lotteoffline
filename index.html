<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•˜ì´ë§ˆíŠ¸ ì œíœ´ ì˜ì—… ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=nrjjvl8zmx"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        /* ë¡ ì•¤ë¹„ì¦ˆ ìŠ¤íƒ€ì¼ ê³„ìŠ¹ */
        :root {
            --primary-color: #333; /* ê¸°ë³¸ í…ìŠ¤íŠ¸ */
            --himart-color: #E30613; /* ë¡¯ë° ë ˆë“œ */
            --apt-color: #007bff;     /* ì•„íŒŒíŠ¸ ë¸”ë£¨ */
            --agent-color: #28a745;   /* ì¤‘ê°œì‚¬ ê·¸ë¦° */
            --background-color: #e9ecef;
            --border-radius: 8px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--background-color);
            color: #333;
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh; /* ì „ì²´ í™”ë©´ ê½‰ ì°¨ê²Œ */
            overflow: hidden;
        }

        /* ì™¼ìª½ ë©”ì¸ ì»¨í…Œì´ë„ˆ (ì œëª© + ì§€ë„) */
        .container {
            flex: 3;
            padding: 20px;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        h1 {
            margin-bottom: 10px;
            font-size: 24px;
        }

        #map {
            flex: 1; /* ë‚¨ì€ ê³µê°„ ëª¨ë‘ ì°¨ì§€ */
            width: 100%;
            margin-top: 10px;
            border-radius: var(--border-radius);
            border: 1px solid #dee2e6;
        }

        /* ì˜¤ë¥¸ìª½ í•„í„° íŒ¨ë„ */
        .filter-panel {
            flex: 1;
            background: #f8f9fa;
            padding: 20px;
            border-left: 2px solid #dee2e6;
            min-width: 320px;
            display: flex;
            flex-direction: column;
            overflow-y: hidden; /* ë‚´ë¶€ ë¦¬ìŠ¤íŠ¸ë§Œ ìŠ¤í¬ë¡¤ ë˜ê²Œ */
        }

        @media (max-width: 768px) {
            body { flex-direction: column; overflow: auto; }
            .container { flex: none; height: 500px; }
            .filter-panel { flex: none; }
        }

        .file-upload-container {
            margin-bottom: 10px;
        }

        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background-color: #f0f0f0;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        button:hover { background-color: #e0e0e0; }
        button.active { background-color: #333; color: white; }

        /* ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        #resultCount { margin: 15px 0 5px 0; font-weight: bold; font-size: 14px; color: #666; }
        
        #targetList {
            flex: 1;
            overflow-y: auto;
            padding-right: 5px;
            margin-top: 10px;
        }

        #targetList li {
            list-style: none;
            padding: 15px;
            border-radius: var(--border-radius);
            background: white;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
            cursor: pointer;
            border-left: 4px solid transparent;
        }

        #targetList li:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            background-color: #fff;
            border-left-color: var(--apt-color);
        }

        .filter-section { padding: 15px 0; }
        .filter-divider { margin: 10px 0; border: none; border-top: 1px solid #dee2e6; }
        .filter-section label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; }

        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 5px;
        }

        /* ë±ƒì§€ ìŠ¤íƒ€ì¼ */
        .badge {
            display: inline-block;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 4px;
            color: white;
            margin-right: 4px;
        }

        /* ë¡œë”© & ì—ëŸ¬ */
        .loading {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95); padding: 30px;
            border-radius: var(--border-radius); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: none; z-index: 1000; text-align: center; font-weight: bold;
        }
        .error-message {
            color: #dc3545; background-color: #f8d7da;
            padding: 10px; border-radius: var(--border-radius);
            display: none; margin-bottom: 10px;
        }

        /* ì§€ë„ ë²”ë¡€ */
        .map-legend {
            position: absolute; top: 80px; left: 40px;
            background: white; padding: 12px; border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 100; font-size: 12px;
        }
        .legend-row { display: flex; align-items: center; margin-bottom: 5px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; margin-right: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center;">í•˜ì´ë§ˆíŠ¸ ì œíœ´ ì˜ì—… íƒ€ê²ŸíŒ…<br><span style="font-size: 0.8rem; color: #666;">(ë§¤ì¥ Â· ì…ì£¼ë‹¨ì§€ Â· ì¤‘ê°œì‚¬)</span></h1>
        
        <div class="file-upload-container" style="text-align: center;">
            <button id="refreshData">ë°ì´í„° ìƒˆë¡œê³ ì¹¨</button>
            <div id="uploadError" class="error-message"></div>
        </div>

        <div id="map"></div>
        
        <div class="map-legend">
            <div class="legend-row"><div class="dot" style="background:var(--himart-color)"></div>í•˜ì´ë§ˆíŠ¸ (ë°˜ê²½ 2km)</div>
            <div class="legend-row"><div class="dot" style="background:var(--apt-color)"></div>ì…ì£¼ ì˜ˆì • ë‹¨ì§€</div>
            <div class="legend-row"><div class="dot" style="background:var(--agent-color)"></div>ì¤‘ê°œì‚¬ë¬´ì†Œ</div>
        </div>

        <div id="loading" class="loading">
            ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...<br>
            <span style="font-size:12px; color:#666; font-weight:normal;">(CSV 3ê°œ ë³‘í•© ì¤‘)</span>
        </div>
    </div>

    <div class="filter-panel">
        <h3>í•„í„° & íƒ€ê²Ÿ ë¦¬ìŠ¤íŠ¸</h3>
        
        <div class="filter-section">
            <label>ì§€ì—­ êµ¬ë¶„:</label>
            <div class="region-buttons">
                <button data-region="ì „ì²´" class="active">ì „ì²´</button>
                <button data-region="ìˆ˜ë„ê¶Œ">ìˆ˜ë„ê¶Œ</button>
                <button data-region="ì§€ë°©">ì§€ë°©</button>
            </div>
        </div>

        <hr class="filter-divider">

        <div class="filter-section">
            <label>ì…ì£¼ë‹¨ì§€ ê·œëª¨ (ì„¸ëŒ€ìˆ˜):</label>
            <select id="sizeFilter">
                <option value="0">ì „ì²´ ë³´ê¸°</option>
                <option value="500">500ì„¸ëŒ€ ì´ìƒ</option>
                <option value="1000">1000ì„¸ëŒ€ ì´ìƒ (ëŒ€ë‹¨ì§€)</option>
            </select>
        </div>

        <div class="filter-section">
            <label>ê²€ìƒ‰ (ì•„íŒŒíŠ¸/ì§€ì—­ëª…):</label>
            <div style="display:flex; gap:5px;">
                <input type="text" id="searchInput" placeholder="ì˜ˆ: ìì´, ê°•ë‚¨êµ¬">
                <button onclick="MapController.getInstance().filterData()" style="padding:8px;">ğŸ”</button>
            </div>
        </div>

        <button onclick="MapController.getInstance().resetFilters()" style="width:100%; margin-top:10px; background:#666; color:white;">í•„í„° ì´ˆê¸°í™”</button>

        <p id="resultCount">íƒ€ê²Ÿ ë‹¨ì§€: 0ê³³</p>
        <ul id="targetList">
            </ul>
    </div>

    <script>
        // âœ… ë°ì´í„° ë§í¬ ì„¤ì •
        const URLS = {
            himart: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQcOgR-HcluU57Cp9eXXSEsM8eU9wC_OvCEMktuZpofT0cNZRw18ZDRUBpqDXygA_nMucWIMmN0Uq35/pub?gid=0&single=true&output=csv',
            apt: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQcOgR-HcluU57Cp9eXXSEsM8eU9wC_OvCEMktuZpofT0cNZRw18ZDRUBpqDXygA_nMucWIMmN0Uq35/pub?gid=412812614&single=true&output=csv', 
            agent: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQcOgR-HcluU57Cp9eXXSEsM8eU9wC_OvCEMktuZpofT0cNZRw18ZDRUBpqDXygA_nMucWIMmN0Uq35/pub?gid=222467253&single=true&output=csv'
        };

        class MapController {
            static instance = null;
            
            constructor() {
                this.map = null;
                this.data = { himart: [], apt: [], agent: [] };
                this.markers = [];
                this.circles = [];
                this.infoWindow = null;
                this.currentRegion = "ì „ì²´";

                this.initializeMap();
            }

            static getInstance() {
                if (!MapController.instance) MapController.instance = new MapController();
                return MapController.instance;
            }

            async initializeMap() {
                try {
                    this.initMap();
                    this.initEventListeners();
                    await this.loadAllData();
                } catch (error) {
                    this.showError('ì´ˆê¸°í™” ì‹¤íŒ¨: ' + error.message);
                }
            }

            initMap() {
                this.map = new naver.maps.Map('map', {
                    center: new naver.maps.LatLng(37.5666805, 126.9784147),
                    zoom: 11,
                    scaleControl: true,
                    mapDataControl: true,
                    zoomControl: true,
                    zoomControlOptions: { position: naver.maps.Position.TOP_RIGHT }
                });

                this.infoWindow = new naver.maps.InfoWindow({
                    maxWidth: 320,
                    backgroundColor: "#fff",
                    borderColor: "#ccc",
                    borderWidth: 1,
                    anchorSize: new naver.maps.Size(10, 10),
                    anchorSkew: true
                });

                naver.maps.Event.addListener(this.map, 'click', () => {
                    if (this.infoWindow.getMap()) this.infoWindow.close();
                });
            }

            initEventListeners() {
                document.getElementById('refreshData').addEventListener('click', () => this.loadAllData());
                
                // ì§€ì—­ ë²„íŠ¼ ì´ë²¤íŠ¸
                document.querySelectorAll('.region-buttons button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        document.querySelectorAll('.region-buttons button').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentRegion = e.target.dataset.region;
                        this.filterData();
                    });
                });

                // ì„¸ëŒ€ìˆ˜ í•„í„° ë³€ê²½ ì‹œ ìë™ ê²€ìƒ‰
                document.getElementById('sizeFilter').addEventListener('change', () => this.filterData());
                
                // ì—”í„°í‚¤ ê²€ìƒ‰
                document.getElementById('searchInput').addEventListener('keypress', (e) => {
                    if(e.key === 'Enter') this.filterData();
                });
            }

            async loadAllData() {
                this.showLoading(true);
                try {
                    // Promise.allë¡œ 3ê°œ CSV ë™ì‹œ ë¡œë“œ
                    const results = await Promise.all([
                        this.fetchCSV(URLS.himart),
                        this.fetchCSV(URLS.apt),
                        this.fetchCSV(URLS.agent)
                    ]);

                    this.data.himart = results[0];
                    this.data.apt = results[1];
                    this.data.agent = results[2];

                    console.log("ë°ì´í„° ë¡œë“œ ì™„ë£Œ:", this.data);
                    
                    // ì´ˆê¸° ë Œë”ë§
                    this.renderMapItems(this.data.himart, this.data.apt, this.data.agent);
                    this.updateList(this.data.apt); // ë¦¬ìŠ¤íŠ¸ëŠ” ì•„íŒŒíŠ¸ ê¸°ì¤€
                    
                } catch (error) {
                    console.error(error);
                    this.showError('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            fetchCSV(url) {
                return new Promise((resolve, reject) => {
                    Papa.parse(url, {
                        download: true,
                        header: true,
                        skipEmptyLines: true,
                        complete: (res) => resolve(res.data),
                        error: (err) => reject(err)
                    });
                });
            }

            // ì§€ë„ì— ë§ˆì»¤ ë¿Œë¦¬ê¸° (í•„í„°ë§ëœ ë°ì´í„°ë§Œ ë°›ìŒ)
            renderMapItems(himarts, apts, agents) {
                // ê¸°ì¡´ ë§ˆì»¤ ì´ˆê¸°í™”
                this.markers.forEach(m => m.setMap(null));
                this.circles.forEach(c => c.setMap(null));
                this.markers = [];
                this.circles = [];

                const bounds = new naver.maps.LatLngBounds();
                let hasData = false;

                // 1. í•˜ì´ë§ˆíŠ¸ (í•­ìƒ í‘œì‹œí•˜ë˜, í•„í„°ë§ ë²”ìœ„ì— ë”°ë¼ ì¤Œ ì¡°ì •ìš©)
                // í•˜ì´ë§ˆíŠ¸ëŠ” í•„í„°ë§ ëŒ€ìƒì´ ì•„ë‹ˆë¯€ë¡œ ì „ì²´ ë°ì´í„° ì‚¬ìš© (ì›í•˜ì‹œë©´ í•„í„°ë§ ê°€ëŠ¥)
                this.data.himart.forEach(item => {
                    if(!item['ìœ„ë„'] || !item['ê²½ë„']) return;
                    const pos = new naver.maps.LatLng(item['ìœ„ë„'], item['ê²½ë„']);
                    
                    this.createMarker(pos, 'himart', item);
                    
                    // ë°˜ê²½ 2km
                    const circle = new naver.maps.Circle({
                        map: this.map,
                        center: pos,
                        radius: 2000,
                        fillColor: '#E30613',
                        fillOpacity: 0.05,
                        strokeColor: '#E30613',
                        strokeOpacity: 0.3,
                        strokeWeight: 1,
                        clickable: false
                    });
                    this.circles.push(circle);
                });

                // 2. ì¤‘ê°œì‚¬ (ë„ˆë¬´ ë§ìœ¼ë©´ ì§€ë„ ëŠë ¤ì§€ë¯€ë¡œ, í˜„ì¬ ë¦¬ìŠ¤íŠ¸ì— ìˆëŠ” ì•„íŒŒíŠ¸ ì£¼ë³€ë§Œ ë³´ì—¬ì¤„ ìˆ˜ë„ ìˆìŒ. ì¼ë‹¨ ë‹¤ í‘œì‹œ)
                // ì„±ëŠ¥ ìœ„í•´ ì•„íŒŒíŠ¸ í•„í„°ë§ ë˜ë©´ ê·¸ ì£¼ë³€ë§Œ ë³´ì—¬ì£¼ëŠ” ê²Œ ì¢‹ì§€ë§Œ, ì¼ë‹¨ ì „ì²´ í‘œì‹œ
                agents.forEach(item => {
                    if(!item['ìœ„ë„'] || !item['ê²½ë„']) return;
                    const pos = new naver.maps.LatLng(item['ìœ„ë„'], item['ê²½ë„']);
                    this.createMarker(pos, 'agent', item);
                });

                // 3. ì…ì£¼ë‹¨ì§€ (í•„í„°ë§ëœ ë°ì´í„°ë§Œ)
                apts.forEach(item => {
                    if(!item['ìœ„ë„'] || !item['ê²½ë„']) return;
                    const pos = new naver.maps.LatLng(item['ìœ„ë„'], item['ê²½ë„']);
                    this.createMarker(pos, 'apt', item);
                    bounds.extend(pos);
                    hasData = true;
                });

                // ë°ì´í„° ìˆëŠ” ê³³ìœ¼ë¡œ ì§€ë„ ì´ë™
                if(hasData) {
                    this.map.fitBounds(bounds);
                } else if (this.data.himart.length > 0) {
                    // í•„í„° ê²°ê³¼ ì—†ìœ¼ë©´ í•˜ì´ë§ˆíŠ¸ ê¸°ì¤€ìœ¼ë¡œë¼ë„ ì¡ìŒ
                    const first = this.data.himart[0];
                    this.map.setCenter(new naver.maps.LatLng(first['ìœ„ë„'], first['ê²½ë„']));
                    this.map.setZoom(10);
                }
            }

            createMarker(position, type, data) {
                let zIndex, contentHTML;

                if(type === 'himart') {
                    zIndex = 100;
                    contentHTML = `<div style="background:#E30613; width:24px; height:24px; border-radius:50%; border:2px solid white; box-shadow:0 2px 5px rgba(0,0,0,0.3); text-align:center; color:white; font-weight:bold; font-size:13px; line-height:20px;">H</div>`;
                } else if (type === 'apt') {
                    zIndex = 110;
                    // ëŒ€ë‹¨ì§€ ê°•ì¡°
                    const size = parseInt((data['ì„¸ëŒ€ìˆ˜']||'0').replace(/,/g, ''));
                    const isBig = size >= 1000;
                    const width = isBig ? 24 : 16;
                    contentHTML = `<div style="background:#007bff; width:${width}px; height:${width}px; transform:rotate(45deg); border:2px solid white; box-shadow:0 2px 5px rgba(0,0,0,0.3);"></div>`;
                } else {
                    zIndex = 90;
                    contentHTML = `<div style="background:#28a745; width:8px; height:8px; border-radius:50%; border:1px solid white; opacity:0.8;"></div>`;
                }

                const marker = new naver.maps.Marker({
                    position: position,
                    map: this.map,
                    zIndex: zIndex,
                    icon: {
                        content: contentHTML,
                        anchor: new naver.maps.Point(12, 12)
                    }
                });

                naver.maps.Event.addListener(marker, 'click', () => {
                    this.showInfoWindow(marker, type, data);
                });

                this.markers.push(marker);
            }

            showInfoWindow(marker, type, data) {
                let content = '<div style="padding:15px; min-width:220px;">';
                
                if(type === 'himart') {
                    content += `<h3 style="color:#E30613; margin:0 0 5px 0;">${data['ì§€ì ëª…']}</h3>`;
                    content += `<p style="font-size:13px; color:#666;">${data['ì£¼ì†Œ']}</p>`;
                    if(data['ì•ˆì‹¬ì¼€ì–´ ì „ë¬¸ìƒë‹´ì„¼í„° ìœ ë¬´'] === 'Y' || data['ì•ˆì‹¬ì¼€ì–´ ì „ë¬¸ìƒë‹´ì„¼í„° ìœ ë¬´'] === 'O') {
                        content += `<span class="badge" style="background:#E30613; margin-top:5px;">ì•ˆì‹¬ì¼€ì–´ ì „ë¬¸ì„¼í„°</span>`;
                    }
                } else if(type === 'apt') {
                    content += `<h3 style="color:#007bff; margin:0 0 5px 0;">${data['ì£¼íƒëª…']}</h3>`;
                    content += `<p style="margin:5px 0;">ğŸ  <b>${data['ì„¸ëŒ€ìˆ˜']}ì„¸ëŒ€</b> | ${data['ì—°ì›”']}</p>`;
                    content += `<div style="background:#f8f9fa; padding:8px; font-size:12px; border-radius:4px;">
                        ë§¤ë§¤ ${data['ë§¤ë§¤']} / ì „ì„¸ ${data['ì „ì„¸']} / ì›”ì„¸ ${data['ì›”ì„¸']}
                    </div>`;
                    content += `<p style="font-size:12px; color:#888; margin-top:5px;">${data['ì£¼ì†Œ']}</p>`;
                } else {
                    content += `<h3 style="color:#28a745; margin:0 0 5px 0;">${data['ì¤‘ê°œì—…ì†Œëª…']}</h3>`;
                    content += `<p style="font-size:13px;">ğŸ‘¤ ${data['ì„±í•¨']} (${data['ì—°ë½ì²˜']})</p>`;
                    content += `<p style="font-size:12px; color:#888;">${data['ì „ì²´ ì£¼ì†Œ']}</p>`;
                }
                content += '</div>';

                this.infoWindow.setContent(content);
                this.infoWindow.open(this.map, marker);
            }

            // í•„í„°ë§ ë¡œì§
            filterData() {
                const minSize = parseInt(document.getElementById('sizeFilter').value);
                const keyword = document.getElementById('searchInput').value.toLowerCase();
                
                // 1. ì•„íŒŒíŠ¸ í•„í„°ë§
                const filteredApts = this.data.apt.filter(item => {
                    const size = parseInt((item['ì„¸ëŒ€ìˆ˜'] || '0').replace(/,/g, '')) || 0;
                    const name = (item['ì£¼íƒëª…'] || '').toLowerCase();
                    const addr = (item['ì£¼ì†Œ'] || '').toLowerCase();
                    const region = (item['ì‹œë„'] || '');

                    // ì§€ì—­ í•„í„°
                    let regionMatch = true;
                    if (this.currentRegion === "ìˆ˜ë„ê¶Œ") {
                        regionMatch = ["ì„œìš¸", "ê²½ê¸°", "ì¸ì²œ"].some(r => region.includes(r) || addr.includes(r));
                    } else if (this.currentRegion === "ì§€ë°©") {
                        regionMatch = !["ì„œìš¸", "ê²½ê¸°", "ì¸ì²œ"].some(r => region.includes(r) || addr.includes(r));
                    }

                    const sizeMatch = size >= minSize;
                    const keywordMatch = keyword === '' || name.includes(keyword) || addr.includes(keyword);

                    return regionMatch && sizeMatch && keywordMatch;
                });

                // 2. ì§€ë„ ì—…ë°ì´íŠ¸ (ì•„íŒŒíŠ¸ëŠ” í•„í„°ëœ ê²ƒë§Œ, í•˜ì´ë§ˆíŠ¸/ì¤‘ê°œì‚¬ëŠ” ì „ì²´ ë³´ì—¬ì£¼ë˜ í•„ìš”ì‹œ ì¡°ì ˆ)
                this.renderMapItems(this.data.himart, filteredApts, this.data.agent);
                
                // 3. ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                this.updateList(filteredApts);
            }

            resetFilters() {
                document.getElementById('sizeFilter').value = "0";
                document.getElementById('searchInput').value = "";
                this.currentRegion = "ì „ì²´";
                document.querySelectorAll('.region-buttons button').forEach(b => {
                    b.classList.remove('active');
                    if(b.dataset.region === 'ì „ì²´') b.classList.add('active');
                });
                this.filterData();
            }

            // ìš°ì¸¡ íŒ¨ë„ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
            updateList(data) {
                const listEl = document.getElementById('targetList');
                const countEl = document.getElementById('resultCount');
                listEl.innerHTML = '';
                countEl.innerText = `íƒ€ê²Ÿ ë‹¨ì§€: ${data.length}ê³³`;

                // ë„ˆë¬´ ë§ìœ¼ë©´ ìƒìœ„ 100ê°œë§Œ ë Œë”ë§ (ì„±ëŠ¥ ì´ìŠˆ ë°©ì§€)
                const displayData = data.slice(0, 100);

                displayData.forEach(item => {
                    const li = document.createElement('li');
                    
                    const size = parseInt((item['ì„¸ëŒ€ìˆ˜'] || '0').replace(/,/g, ''));
                    let badge = '';
                    if(size >= 1000) badge = `<span class="badge" style="background:#007bff;">ëŒ€ë‹¨ì§€</span>`;

                    li.innerHTML = `
                        <div style="font-weight:bold; font-size:15px; margin-bottom:5px; color:#333;">
                            ${badge} ${item['ì£¼íƒëª…']}
                        </div>
                        <div style="font-size:13px; color:#666;">
                            ${item['ì„¸ëŒ€ìˆ˜']}ì„¸ëŒ€ | ${item['ì—°ì›”']}
                        </div>
                        <div style="font-size:12px; color:#999; margin-top:5px;">
                            ${item['ì£¼ì†Œ']}
                        </div>
                    `;
                    
                    li.onclick = () => {
                        if(item['ìœ„ë„'] && item['ê²½ë„']) {
                            const pos = new naver.maps.LatLng(item['ìœ„ë„'], item['ê²½ë„']);
                            this.map.setCenter(pos);
                            this.map.setZoom(15);
                            // ì„ íƒ íš¨ê³¼
                            document.querySelectorAll('#targetList li').forEach(el => el.style.borderLeftColor = 'transparent');
                            li.style.borderLeftColor = '#007bff';
                        }
                    };
                    listEl.appendChild(li);
                });
            }

            showError(msg) {
                const el = document.getElementById('uploadError');
                el.innerText = msg;
                el.style.display = 'block';
                setTimeout(() => el.style.display = 'none', 5000);
            }

            showLoading(show) {
                document.getElementById('loading').style.display = show ? 'block' : 'none';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            MapController.getInstance();
        });
    </script>
</body>
</html>
